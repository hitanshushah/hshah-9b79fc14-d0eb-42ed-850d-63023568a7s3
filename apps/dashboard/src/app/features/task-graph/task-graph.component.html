<div class="flex flex-col">
  @if (error()) {
    <div class="mx-4 mt-4 rounded-lg border border-red-200 bg-red-50 p-3 text-red-800 dark:border-red-800 dark:bg-red-950/30 dark:text-red-200">
      {{ error() }}
    </div>
  }

  <main class="flex-1 overflow-auto p-6">
    <div class="mb-4 flex items-center gap-3">
      <a
        routerLink="/"
        class="flex items-center gap-1.5 rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600"
      >
        ← Back
      </a>
      <h1 class="text-xl font-semibold text-slate-800 dark:text-slate-100">Task completion</h1>
    </div>
    @if (loading()) {
      <p class="text-slate-500 dark:text-slate-400">Loading…</p>
    } @else {
      <div class="mx-auto max-w-4xl space-y-6">
        <div class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-5">
          <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-600 dark:bg-slate-800">
            <p class="text-xs font-medium uppercase tracking-wide text-slate-500 dark:text-slate-400">All</p>
            <p class="mt-1 text-2xl font-bold text-slate-800 dark:text-slate-100">{{ total() }}</p>
            <p class="text-sm text-slate-500 dark:text-slate-400">tasks</p>
          </div>
          <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-600 dark:bg-slate-800">
            <p class="text-xs font-medium uppercase tracking-wide text-slate-500 dark:text-slate-400">Complete</p>
            <p class="mt-1 text-2xl font-bold text-green-600 dark:text-green-400">{{ completeCount() }}</p>
            <p class="text-sm text-slate-500 dark:text-slate-400">done</p>
          </div>
          <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-600 dark:bg-slate-800">
            <p class="text-xs font-medium uppercase tracking-wide text-slate-500 dark:text-slate-400">In progress</p>
            <p class="mt-1 text-2xl font-bold text-blue-600 dark:text-blue-400">{{ inProgressCount() }}</p>
            <p class="text-sm text-slate-500 dark:text-slate-400">active</p>
          </div>
          <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-600 dark:bg-slate-800">
            <p class="text-xs font-medium uppercase tracking-wide text-slate-500 dark:text-slate-400">Blocked</p>
            <p class="mt-1 text-2xl font-bold text-red-600 dark:text-red-400">{{ blockedCount() }}</p>
            <p class="text-sm text-slate-500 dark:text-slate-400">blocked</p>
          </div>
          <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-600 dark:bg-slate-800">
            <p class="text-xs font-medium uppercase tracking-wide text-slate-500 dark:text-slate-400">% complete</p>
            <p class="mt-1 text-2xl font-bold text-slate-800 dark:text-slate-100">{{ percentComplete() }}%</p>
            <p class="text-sm text-slate-500 dark:text-slate-400">of all tasks</p>
          </div>
        </div>

        <div class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-600 dark:bg-slate-800">
          <h2 class="mb-4 text-lg font-semibold text-slate-800 dark:text-slate-100">Tasks by status</h2>
          <div class="flex justify-center">
            <p-chart type="doughnut" [data]="chartData()" [options]="chartOptions" [style]="{ width: '320px', height: '320px' }"></p-chart>
          </div>
        </div>

        @if (showPerOrganization()) {
          <div class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-600 dark:bg-slate-800">
            <h2 class="mb-4 text-lg font-semibold text-slate-800 dark:text-slate-100">Tasks per organization</h2>
            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
              @for (org of orgStats(); track org.orgId) {
                <div class="rounded-lg border border-slate-200 bg-slate-50/50 p-4 dark:border-slate-600 dark:bg-slate-800/50">
                  <h3 class="font-semibold text-slate-800 dark:text-slate-100">{{ org.orgName }}</h3>
                  <div class="mt-2 grid grid-cols-2 gap-2 text-sm">
                    <span class="text-slate-500 dark:text-slate-400">Total</span>
                    <span class="font-medium text-slate-800 dark:text-slate-100">{{ org.total }}</span>
                    <span class="text-slate-500 dark:text-slate-400">Complete</span>
                    <span class="font-medium text-green-600 dark:text-green-400">{{ org.complete }}</span>
                    <span class="text-slate-500 dark:text-slate-400">In progress</span>
                    <span class="font-medium text-blue-600 dark:text-blue-400">{{ org.inProgress }}</span>
                    <span class="text-slate-500 dark:text-slate-400">Blocked</span>
                    <span class="font-medium text-red-600 dark:text-red-400">{{ org.blocked }}</span>
                    <span class="text-slate-500 dark:text-slate-400">To do</span>
                    <span class="font-medium text-slate-600 dark:text-slate-300">{{ org.todo }}</span>
                    <span class="text-slate-500 dark:text-slate-400">% complete</span>
                    <span class="font-medium text-slate-800 dark:text-slate-100">{{ org.percentComplete }}%</span>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    }
  </main>
</div>
